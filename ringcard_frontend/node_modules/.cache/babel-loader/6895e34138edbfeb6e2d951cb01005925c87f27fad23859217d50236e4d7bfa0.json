{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _objectSpread = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\nvar _toConsumableArray = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _slicedToArray = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _createForOfIteratorHelper = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _classCallCheck = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RequestHandlerHelper = void 0;\nvar https_1 = require(\"https\");\nvar settings_1 = require(\"../settings\");\nvar TweetStream_1 = __importDefault(require(\"../stream/TweetStream\"));\nvar types_1 = require(\"../types\");\nvar zlib = __importStar(require(\"zlib\"));\nvar RequestHandlerHelper = /*#__PURE__*/function () {\n  function RequestHandlerHelper(requestData) {\n    _classCallCheck(this, RequestHandlerHelper);\n    this.requestData = requestData;\n    this.requestErrorHandled = false;\n    this.responseData = [];\n  }\n  /* Request helpers */\n  _createClass(RequestHandlerHelper, [{\n    key: \"hrefPathname\",\n    get: function get() {\n      var url = this.requestData.url;\n      return url.hostname + url.pathname;\n    }\n  }, {\n    key: \"isCompressionDisabled\",\n    value: function isCompressionDisabled() {\n      return !this.requestData.compression || this.requestData.compression === 'identity';\n    }\n  }, {\n    key: \"isFormEncodedEndpoint\",\n    value: function isFormEncodedEndpoint() {\n      return this.requestData.url.href.startsWith('https://api.twitter.com/oauth/');\n    }\n    /* Error helpers */\n  }, {\n    key: \"createRequestError\",\n    value: function createRequestError(error) {\n      if (settings_1.TwitterApiV2Settings.debug) {\n        settings_1.TwitterApiV2Settings.logger.log('Request error:', error);\n      }\n      return new types_1.ApiRequestError('Request failed.', {\n        request: this.req,\n        error: error\n      });\n    }\n  }, {\n    key: \"createPartialResponseError\",\n    value: function createPartialResponseError(error, abortClose) {\n      var res = this.res;\n      var message = \"Request failed with partial response with HTTP code \".concat(res.statusCode);\n      if (abortClose) {\n        message += ' (connection abruptly closed)';\n      } else {\n        message += ' (parse error)';\n      }\n      return new types_1.ApiPartialResponseError(message, {\n        request: this.req,\n        response: this.res,\n        responseError: error,\n        rawContent: Buffer.concat(this.responseData).toString()\n      });\n    }\n  }, {\n    key: \"formatV1Errors\",\n    value: function formatV1Errors(errors) {\n      return errors.map(function (_ref) {\n        var code = _ref.code,\n          message = _ref.message;\n        return \"\".concat(message, \" (Twitter code \").concat(code, \")\");\n      }).join(', ');\n    }\n  }, {\n    key: \"formatV2Error\",\n    value: function formatV2Error(error) {\n      return \"\".concat(error.title, \": \").concat(error.detail, \" (see \").concat(error.type, \")\");\n    }\n  }, {\n    key: \"createResponseError\",\n    value: function createResponseError(_ref2) {\n      var res = _ref2.res,\n        data = _ref2.data,\n        rateLimit = _ref2.rateLimit,\n        code = _ref2.code;\n      var _a;\n      if (settings_1.TwitterApiV2Settings.debug) {\n        settings_1.TwitterApiV2Settings.logger.log(\"Request failed with code \".concat(code, \", data:\"), data);\n        settings_1.TwitterApiV2Settings.logger.log('Response headers:', res.headers);\n      }\n      // Errors formatting.\n      var errorString = \"Request failed with code \".concat(code);\n      if ((_a = data === null || data === void 0 ? void 0 : data.errors) === null || _a === void 0 ? void 0 : _a.length) {\n        var errors = data.errors;\n        if ('code' in errors[0]) {\n          errorString += ' - ' + this.formatV1Errors(errors);\n        } else {\n          errorString += ' - ' + this.formatV2Error(data);\n        }\n      }\n      return new types_1.ApiResponseError(errorString, {\n        code: code,\n        data: data,\n        headers: res.headers,\n        request: this.req,\n        response: res,\n        rateLimit: rateLimit\n      });\n    }\n    /* Response helpers */\n  }, {\n    key: \"getResponseDataStream\",\n    value: function getResponseDataStream(res) {\n      if (this.isCompressionDisabled()) {\n        return res;\n      }\n      var contentEncoding = (res.headers['content-encoding'] || 'identity').trim().toLowerCase();\n      if (contentEncoding === 'br') {\n        var brotli = zlib.createBrotliDecompress({\n          flush: zlib.constants.BROTLI_OPERATION_FLUSH,\n          finishFlush: zlib.constants.BROTLI_OPERATION_FLUSH\n        });\n        res.pipe(brotli);\n        return brotli;\n      }\n      if (contentEncoding === 'gzip') {\n        var gunzip = zlib.createGunzip({\n          flush: zlib.constants.Z_SYNC_FLUSH,\n          finishFlush: zlib.constants.Z_SYNC_FLUSH\n        });\n        res.pipe(gunzip);\n        return gunzip;\n      }\n      if (contentEncoding === 'deflate') {\n        var inflate = zlib.createInflate({\n          flush: zlib.constants.Z_SYNC_FLUSH,\n          finishFlush: zlib.constants.Z_SYNC_FLUSH\n        });\n        res.pipe(inflate);\n        return inflate;\n      }\n      return res;\n    }\n  }, {\n    key: \"detectResponseType\",\n    value: function detectResponseType(res) {\n      var _a, _b;\n      // Auto parse if server responds with JSON body\n      if (((_a = res.headers['content-type']) === null || _a === void 0 ? void 0 : _a.includes('application/json')) || ((_b = res.headers['content-type']) === null || _b === void 0 ? void 0 : _b.includes('application/problem+json'))) {\n        return 'json';\n      }\n      // f-e oauth token endpoints\n      else if (this.isFormEncodedEndpoint()) {\n        return 'url';\n      }\n      return 'text';\n    }\n  }, {\n    key: \"getParsedResponse\",\n    value: function getParsedResponse(res) {\n      var data = this.responseData;\n      var mode = this.requestData.forceParseMode || this.detectResponseType(res);\n      if (mode === 'buffer') {\n        return Buffer.concat(data);\n      } else if (mode === 'text') {\n        return Buffer.concat(data).toString();\n      } else if (mode === 'json') {\n        var asText = Buffer.concat(data).toString();\n        return asText.length ? JSON.parse(asText) : undefined;\n      } else if (mode === 'url') {\n        var _asText = Buffer.concat(data).toString();\n        var formEntries = {};\n        var _iterator = _createForOfIteratorHelper(new URLSearchParams(_asText)),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var _step$value = _slicedToArray(_step.value, 2),\n              item = _step$value[0],\n              value = _step$value[1];\n            formEntries[item] = value;\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n        return formEntries;\n      } else {\n        // mode === 'none'\n        return undefined;\n      }\n    }\n  }, {\n    key: \"getRateLimitFromResponse\",\n    value: function getRateLimitFromResponse(res) {\n      var rateLimit = undefined;\n      if (res.headers['x-rate-limit-limit']) {\n        rateLimit = {\n          limit: Number(res.headers['x-rate-limit-limit']),\n          remaining: Number(res.headers['x-rate-limit-remaining']),\n          reset: Number(res.headers['x-rate-limit-reset'])\n        };\n        if (this.requestData.rateLimitSaver) {\n          this.requestData.rateLimitSaver(rateLimit);\n        }\n      }\n      return rateLimit;\n    }\n    /* Request event handlers */\n  }, {\n    key: \"onSocketEventHandler\",\n    value: function onSocketEventHandler(reject, socket) {\n      socket.on('close', this.onSocketCloseHandler.bind(this, reject));\n    }\n  }, {\n    key: \"onSocketCloseHandler\",\n    value: function onSocketCloseHandler(reject) {\n      this.req.removeAllListeners('timeout');\n      var res = this.res;\n      if (res) {\n        // Response ok, res.close/res.end can handle request ending\n        return;\n      }\n      if (!this.requestErrorHandled) {\n        return reject(this.createRequestError(new Error('Socket closed without any information.')));\n      }\n      // else: other situation\n    }\n  }, {\n    key: \"requestErrorHandler\",\n    value: function requestErrorHandler(reject, requestError) {\n      var _a, _b;\n      (_b = (_a = this.requestData).requestEventDebugHandler) === null || _b === void 0 ? void 0 : _b.call(_a, 'request-error', {\n        requestError: requestError\n      });\n      this.requestErrorHandled = true;\n      reject(this.createRequestError(requestError));\n    }\n  }, {\n    key: \"timeoutErrorHandler\",\n    value: function timeoutErrorHandler() {\n      this.requestErrorHandled = true;\n      this.req.destroy(new Error('Request timeout.'));\n    }\n    /* Response event handlers */\n  }, {\n    key: \"classicResponseHandler\",\n    value: function classicResponseHandler(resolve, reject, res) {\n      var _this = this;\n      this.res = res;\n      var dataStream = this.getResponseDataStream(res);\n      // Register the response data\n      dataStream.on('data', function (chunk) {\n        return _this.responseData.push(chunk);\n      });\n      dataStream.on('end', this.onResponseEndHandler.bind(this, resolve, reject));\n      dataStream.on('close', this.onResponseCloseHandler.bind(this, resolve, reject));\n      // Debug handlers\n      if (this.requestData.requestEventDebugHandler) {\n        this.requestData.requestEventDebugHandler('response', {\n          res: res\n        });\n        res.on('aborted', function (error) {\n          return _this.requestData.requestEventDebugHandler('response-aborted', {\n            error: error\n          });\n        });\n        res.on('error', function (error) {\n          return _this.requestData.requestEventDebugHandler('response-error', {\n            error: error\n          });\n        });\n        res.on('close', function () {\n          return _this.requestData.requestEventDebugHandler('response-close', {\n            data: _this.responseData\n          });\n        });\n        res.on('end', function () {\n          return _this.requestData.requestEventDebugHandler('response-end');\n        });\n      }\n    }\n  }, {\n    key: \"onResponseEndHandler\",\n    value: function onResponseEndHandler(resolve, reject) {\n      var rateLimit = this.getRateLimitFromResponse(this.res);\n      var data;\n      try {\n        data = this.getParsedResponse(this.res);\n      } catch (e) {\n        reject(this.createPartialResponseError(e, false));\n        return;\n      }\n      // Handle bad error codes\n      var code = this.res.statusCode;\n      if (code >= 400) {\n        reject(this.createResponseError({\n          data: data,\n          res: this.res,\n          rateLimit: rateLimit,\n          code: code\n        }));\n        return;\n      }\n      if (settings_1.TwitterApiV2Settings.debug) {\n        settings_1.TwitterApiV2Settings.logger.log(\"[\".concat(this.requestData.options.method, \" \").concat(this.hrefPathname, \"]: Request succeeds with code \").concat(this.res.statusCode));\n        settings_1.TwitterApiV2Settings.logger.log('Response body:', data);\n      }\n      resolve({\n        data: data,\n        headers: this.res.headers,\n        rateLimit: rateLimit\n      });\n    }\n  }, {\n    key: \"onResponseCloseHandler\",\n    value: function onResponseCloseHandler(resolve, reject) {\n      var res = this.res;\n      if (res.aborted) {\n        // Try to parse the request (?)\n        try {\n          this.getParsedResponse(this.res);\n          // Ok, try to resolve normally the request\n          return this.onResponseEndHandler(resolve, reject);\n        } catch (e) {\n          // Parse error, just drop with content\n          return reject(this.createPartialResponseError(e, true));\n        }\n      }\n      if (!res.complete) {\n        return reject(this.createPartialResponseError(new Error('Response has been interrupted before response could be parsed.'), true));\n      }\n      // else: end has been called\n    }\n  }, {\n    key: \"streamResponseHandler\",\n    value: function streamResponseHandler(resolve, reject, res) {\n      var code = res.statusCode;\n      if (code < 400) {\n        if (settings_1.TwitterApiV2Settings.debug) {\n          settings_1.TwitterApiV2Settings.logger.log(\"[\".concat(this.requestData.options.method, \" \").concat(this.hrefPathname, \"]: Request succeeds with code \").concat(res.statusCode, \" (starting stream)\"));\n        }\n        var dataStream = this.getResponseDataStream(res);\n        // HTTP code ok, consume stream\n        resolve({\n          req: this.req,\n          res: dataStream,\n          originalResponse: res,\n          requestData: this.requestData\n        });\n      } else {\n        // Handle response normally, can only rejects\n        this.classicResponseHandler(function () {\n          return undefined;\n        }, reject, res);\n      }\n    }\n    /* Wrappers for request lifecycle */\n  }, {\n    key: \"debugRequest\",\n    value: function debugRequest() {\n      var url = this.requestData.url;\n      settings_1.TwitterApiV2Settings.logger.log(\"[\".concat(this.requestData.options.method, \" \").concat(this.hrefPathname, \"]\"), this.requestData.options);\n      if (url.search) {\n        settings_1.TwitterApiV2Settings.logger.log('Request parameters:', _toConsumableArray(url.searchParams.entries()).map(function (_ref3) {\n          var _ref4 = _slicedToArray(_ref3, 2),\n            key = _ref4[0],\n            value = _ref4[1];\n          return \"\".concat(key, \": \").concat(value);\n        }));\n      }\n      if (this.requestData.body) {\n        settings_1.TwitterApiV2Settings.logger.log('Request body:', this.requestData.body);\n      }\n    }\n  }, {\n    key: \"buildRequest\",\n    value: function buildRequest() {\n      var _a;\n      var url = this.requestData.url;\n      var auth = url.username ? \"\".concat(url.username, \":\").concat(url.password) : undefined;\n      var headers = (_a = this.requestData.options.headers) !== null && _a !== void 0 ? _a : {};\n      if (this.requestData.compression === true || this.requestData.compression === 'brotli') {\n        headers['accept-encoding'] = 'br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1';\n      } else if (this.requestData.compression === 'gzip') {\n        headers['accept-encoding'] = 'gzip;q=1, deflate;q=0.5, *;q=0.1';\n      } else if (this.requestData.compression === 'deflate') {\n        headers['accept-encoding'] = 'deflate;q=1, *;q=0.1';\n      }\n      if (settings_1.TwitterApiV2Settings.debug) {\n        this.debugRequest();\n      }\n      this.req = (0, https_1.request)(_objectSpread(_objectSpread({}, this.requestData.options), {}, {\n        // Define URL params manually, addresses dependencies error https://github.com/PLhery/node-twitter-api-v2/issues/94\n        host: url.hostname,\n        port: url.port || undefined,\n        path: url.pathname + url.search,\n        protocol: url.protocol,\n        auth: auth,\n        headers: headers\n      }));\n    }\n  }, {\n    key: \"registerRequestEventDebugHandlers\",\n    value: function registerRequestEventDebugHandlers(req) {\n      var _this2 = this;\n      req.on('close', function () {\n        return _this2.requestData.requestEventDebugHandler('close');\n      });\n      req.on('abort', function () {\n        return _this2.requestData.requestEventDebugHandler('abort');\n      });\n      req.on('socket', function (socket) {\n        _this2.requestData.requestEventDebugHandler('socket', {\n          socket: socket\n        });\n        socket.on('error', function (error) {\n          return _this2.requestData.requestEventDebugHandler('socket-error', {\n            socket: socket,\n            error: error\n          });\n        });\n        socket.on('connect', function () {\n          return _this2.requestData.requestEventDebugHandler('socket-connect', {\n            socket: socket\n          });\n        });\n        socket.on('close', function (withError) {\n          return _this2.requestData.requestEventDebugHandler('socket-close', {\n            socket: socket,\n            withError: withError\n          });\n        });\n        socket.on('end', function () {\n          return _this2.requestData.requestEventDebugHandler('socket-end', {\n            socket: socket\n          });\n        });\n        socket.on('lookup', function () {\n          for (var _len = arguments.length, data = new Array(_len), _key = 0; _key < _len; _key++) {\n            data[_key] = arguments[_key];\n          }\n          return _this2.requestData.requestEventDebugHandler('socket-lookup', {\n            socket: socket,\n            data: data\n          });\n        });\n        socket.on('timeout', function () {\n          return _this2.requestData.requestEventDebugHandler('socket-timeout', {\n            socket: socket\n          });\n        });\n      });\n    }\n  }, {\n    key: \"makeRequest\",\n    value: function makeRequest() {\n      var _this3 = this;\n      this.buildRequest();\n      return new Promise(function (resolve, reject) {\n        var req = _this3.req;\n        // Handle request errors\n        req.on('error', _this3.requestErrorHandler.bind(_this3, reject));\n        req.on('socket', _this3.onSocketEventHandler.bind(_this3, reject));\n        req.on('response', _this3.classicResponseHandler.bind(_this3, resolve, reject));\n        if (_this3.requestData.options.timeout) {\n          req.on('timeout', _this3.timeoutErrorHandler.bind(_this3));\n        }\n        // Debug handlers\n        if (_this3.requestData.requestEventDebugHandler) {\n          _this3.registerRequestEventDebugHandlers(req);\n        }\n        if (_this3.requestData.body) {\n          req.write(_this3.requestData.body);\n        }\n        req.end();\n      });\n    }\n  }, {\n    key: \"makeRequestAsStream\",\n    value: function () {\n      var _makeRequestAsStream = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _yield$this$makeReque, req, res, requestData, originalResponse;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.makeRequestAndResolveWhenReady();\n              case 2:\n                _yield$this$makeReque = _context.sent;\n                req = _yield$this$makeReque.req;\n                res = _yield$this$makeReque.res;\n                requestData = _yield$this$makeReque.requestData;\n                originalResponse = _yield$this$makeReque.originalResponse;\n                return _context.abrupt(\"return\", new TweetStream_1.default(requestData, {\n                  req: req,\n                  res: res,\n                  originalResponse: originalResponse\n                }));\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function makeRequestAsStream() {\n        return _makeRequestAsStream.apply(this, arguments);\n      }\n      return makeRequestAsStream;\n    }()\n  }, {\n    key: \"makeRequestAndResolveWhenReady\",\n    value: function makeRequestAndResolveWhenReady() {\n      var _this4 = this;\n      this.buildRequest();\n      return new Promise(function (resolve, reject) {\n        var req = _this4.req;\n        // Handle request errors\n        req.on('error', _this4.requestErrorHandler.bind(_this4, reject));\n        req.on('response', _this4.streamResponseHandler.bind(_this4, resolve, reject));\n        if (_this4.requestData.body) {\n          req.write(_this4.requestData.body);\n        }\n        req.end();\n      });\n    }\n  }]);\n  return RequestHandlerHelper;\n}();\nexports.RequestHandlerHelper = RequestHandlerHelper;\nexports.default = RequestHandlerHelper;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","RequestHandlerHelper","https_1","require","settings_1","TweetStream_1","types_1","zlib","requestData","requestErrorHandled","responseData","url","hostname","pathname","compression","href","startsWith","error","TwitterApiV2Settings","debug","logger","log","ApiRequestError","request","req","abortClose","res","message","statusCode","ApiPartialResponseError","response","responseError","rawContent","Buffer","concat","toString","errors","map","code","join","title","detail","type","data","rateLimit","_a","headers","errorString","length","formatV1Errors","formatV2Error","ApiResponseError","isCompressionDisabled","contentEncoding","trim","toLowerCase","brotli","createBrotliDecompress","flush","constants","BROTLI_OPERATION_FLUSH","finishFlush","pipe","gunzip","createGunzip","Z_SYNC_FLUSH","inflate","createInflate","_b","includes","isFormEncodedEndpoint","mode","forceParseMode","detectResponseType","asText","JSON","parse","formEntries","URLSearchParams","item","limit","Number","remaining","reset","rateLimitSaver","reject","socket","on","onSocketCloseHandler","bind","removeAllListeners","createRequestError","Error","requestError","requestEventDebugHandler","destroy","resolve","dataStream","getResponseDataStream","chunk","push","onResponseEndHandler","onResponseCloseHandler","getRateLimitFromResponse","getParsedResponse","e","createPartialResponseError","createResponseError","options","method","hrefPathname","aborted","complete","originalResponse","classicResponseHandler","search","searchParams","entries","key","body","auth","username","password","debugRequest","host","port","path","protocol","withError","buildRequest","Promise","requestErrorHandler","onSocketEventHandler","timeout","timeoutErrorHandler","registerRequestEventDebugHandlers","write","end","makeRequestAndResolveWhenReady","default","streamResponseHandler"],"sources":["C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/twitter-api-v2/dist/client-mixins/request-handler.helper.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RequestHandlerHelper = void 0;\nconst https_1 = require(\"https\");\nconst settings_1 = require(\"../settings\");\nconst TweetStream_1 = __importDefault(require(\"../stream/TweetStream\"));\nconst types_1 = require(\"../types\");\nconst zlib = __importStar(require(\"zlib\"));\nclass RequestHandlerHelper {\n    constructor(requestData) {\n        this.requestData = requestData;\n        this.requestErrorHandled = false;\n        this.responseData = [];\n    }\n    /* Request helpers */\n    get hrefPathname() {\n        const url = this.requestData.url;\n        return url.hostname + url.pathname;\n    }\n    isCompressionDisabled() {\n        return !this.requestData.compression || this.requestData.compression === 'identity';\n    }\n    isFormEncodedEndpoint() {\n        return this.requestData.url.href.startsWith('https://api.twitter.com/oauth/');\n    }\n    /* Error helpers */\n    createRequestError(error) {\n        if (settings_1.TwitterApiV2Settings.debug) {\n            settings_1.TwitterApiV2Settings.logger.log('Request error:', error);\n        }\n        return new types_1.ApiRequestError('Request failed.', {\n            request: this.req,\n            error,\n        });\n    }\n    createPartialResponseError(error, abortClose) {\n        const res = this.res;\n        let message = `Request failed with partial response with HTTP code ${res.statusCode}`;\n        if (abortClose) {\n            message += ' (connection abruptly closed)';\n        }\n        else {\n            message += ' (parse error)';\n        }\n        return new types_1.ApiPartialResponseError(message, {\n            request: this.req,\n            response: this.res,\n            responseError: error,\n            rawContent: Buffer.concat(this.responseData).toString(),\n        });\n    }\n    formatV1Errors(errors) {\n        return errors\n            .map(({ code, message }) => `${message} (Twitter code ${code})`)\n            .join(', ');\n    }\n    formatV2Error(error) {\n        return `${error.title}: ${error.detail} (see ${error.type})`;\n    }\n    createResponseError({ res, data, rateLimit, code }) {\n        var _a;\n        if (settings_1.TwitterApiV2Settings.debug) {\n            settings_1.TwitterApiV2Settings.logger.log(`Request failed with code ${code}, data:`, data);\n            settings_1.TwitterApiV2Settings.logger.log('Response headers:', res.headers);\n        }\n        // Errors formatting.\n        let errorString = `Request failed with code ${code}`;\n        if ((_a = data === null || data === void 0 ? void 0 : data.errors) === null || _a === void 0 ? void 0 : _a.length) {\n            const errors = data.errors;\n            if ('code' in errors[0]) {\n                errorString += ' - ' + this.formatV1Errors(errors);\n            }\n            else {\n                errorString += ' - ' + this.formatV2Error(data);\n            }\n        }\n        return new types_1.ApiResponseError(errorString, {\n            code,\n            data,\n            headers: res.headers,\n            request: this.req,\n            response: res,\n            rateLimit,\n        });\n    }\n    /* Response helpers */\n    getResponseDataStream(res) {\n        if (this.isCompressionDisabled()) {\n            return res;\n        }\n        const contentEncoding = (res.headers['content-encoding'] || 'identity').trim().toLowerCase();\n        if (contentEncoding === 'br') {\n            const brotli = zlib.createBrotliDecompress({\n                flush: zlib.constants.BROTLI_OPERATION_FLUSH,\n                finishFlush: zlib.constants.BROTLI_OPERATION_FLUSH,\n            });\n            res.pipe(brotli);\n            return brotli;\n        }\n        if (contentEncoding === 'gzip') {\n            const gunzip = zlib.createGunzip({\n                flush: zlib.constants.Z_SYNC_FLUSH,\n                finishFlush: zlib.constants.Z_SYNC_FLUSH,\n            });\n            res.pipe(gunzip);\n            return gunzip;\n        }\n        if (contentEncoding === 'deflate') {\n            const inflate = zlib.createInflate({\n                flush: zlib.constants.Z_SYNC_FLUSH,\n                finishFlush: zlib.constants.Z_SYNC_FLUSH,\n            });\n            res.pipe(inflate);\n            return inflate;\n        }\n        return res;\n    }\n    detectResponseType(res) {\n        var _a, _b;\n        // Auto parse if server responds with JSON body\n        if (((_a = res.headers['content-type']) === null || _a === void 0 ? void 0 : _a.includes('application/json')) || ((_b = res.headers['content-type']) === null || _b === void 0 ? void 0 : _b.includes('application/problem+json'))) {\n            return 'json';\n        }\n        // f-e oauth token endpoints\n        else if (this.isFormEncodedEndpoint()) {\n            return 'url';\n        }\n        return 'text';\n    }\n    getParsedResponse(res) {\n        const data = this.responseData;\n        const mode = this.requestData.forceParseMode || this.detectResponseType(res);\n        if (mode === 'buffer') {\n            return Buffer.concat(data);\n        }\n        else if (mode === 'text') {\n            return Buffer.concat(data).toString();\n        }\n        else if (mode === 'json') {\n            const asText = Buffer.concat(data).toString();\n            return asText.length ? JSON.parse(asText) : undefined;\n        }\n        else if (mode === 'url') {\n            const asText = Buffer.concat(data).toString();\n            const formEntries = {};\n            for (const [item, value] of new URLSearchParams(asText)) {\n                formEntries[item] = value;\n            }\n            return formEntries;\n        }\n        else {\n            // mode === 'none'\n            return undefined;\n        }\n    }\n    getRateLimitFromResponse(res) {\n        let rateLimit = undefined;\n        if (res.headers['x-rate-limit-limit']) {\n            rateLimit = {\n                limit: Number(res.headers['x-rate-limit-limit']),\n                remaining: Number(res.headers['x-rate-limit-remaining']),\n                reset: Number(res.headers['x-rate-limit-reset']),\n            };\n            if (this.requestData.rateLimitSaver) {\n                this.requestData.rateLimitSaver(rateLimit);\n            }\n        }\n        return rateLimit;\n    }\n    /* Request event handlers */\n    onSocketEventHandler(reject, socket) {\n        socket.on('close', this.onSocketCloseHandler.bind(this, reject));\n    }\n    onSocketCloseHandler(reject) {\n        this.req.removeAllListeners('timeout');\n        const res = this.res;\n        if (res) {\n            // Response ok, res.close/res.end can handle request ending\n            return;\n        }\n        if (!this.requestErrorHandled) {\n            return reject(this.createRequestError(new Error('Socket closed without any information.')));\n        }\n        // else: other situation\n    }\n    requestErrorHandler(reject, requestError) {\n        var _a, _b;\n        (_b = (_a = this.requestData).requestEventDebugHandler) === null || _b === void 0 ? void 0 : _b.call(_a, 'request-error', { requestError });\n        this.requestErrorHandled = true;\n        reject(this.createRequestError(requestError));\n    }\n    timeoutErrorHandler() {\n        this.requestErrorHandled = true;\n        this.req.destroy(new Error('Request timeout.'));\n    }\n    /* Response event handlers */\n    classicResponseHandler(resolve, reject, res) {\n        this.res = res;\n        const dataStream = this.getResponseDataStream(res);\n        // Register the response data\n        dataStream.on('data', chunk => this.responseData.push(chunk));\n        dataStream.on('end', this.onResponseEndHandler.bind(this, resolve, reject));\n        dataStream.on('close', this.onResponseCloseHandler.bind(this, resolve, reject));\n        // Debug handlers\n        if (this.requestData.requestEventDebugHandler) {\n            this.requestData.requestEventDebugHandler('response', { res });\n            res.on('aborted', error => this.requestData.requestEventDebugHandler('response-aborted', { error }));\n            res.on('error', error => this.requestData.requestEventDebugHandler('response-error', { error }));\n            res.on('close', () => this.requestData.requestEventDebugHandler('response-close', { data: this.responseData }));\n            res.on('end', () => this.requestData.requestEventDebugHandler('response-end'));\n        }\n    }\n    onResponseEndHandler(resolve, reject) {\n        const rateLimit = this.getRateLimitFromResponse(this.res);\n        let data;\n        try {\n            data = this.getParsedResponse(this.res);\n        }\n        catch (e) {\n            reject(this.createPartialResponseError(e, false));\n            return;\n        }\n        // Handle bad error codes\n        const code = this.res.statusCode;\n        if (code >= 400) {\n            reject(this.createResponseError({ data, res: this.res, rateLimit, code }));\n            return;\n        }\n        if (settings_1.TwitterApiV2Settings.debug) {\n            settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${this.res.statusCode}`);\n            settings_1.TwitterApiV2Settings.logger.log('Response body:', data);\n        }\n        resolve({\n            data,\n            headers: this.res.headers,\n            rateLimit,\n        });\n    }\n    onResponseCloseHandler(resolve, reject) {\n        const res = this.res;\n        if (res.aborted) {\n            // Try to parse the request (?)\n            try {\n                this.getParsedResponse(this.res);\n                // Ok, try to resolve normally the request\n                return this.onResponseEndHandler(resolve, reject);\n            }\n            catch (e) {\n                // Parse error, just drop with content\n                return reject(this.createPartialResponseError(e, true));\n            }\n        }\n        if (!res.complete) {\n            return reject(this.createPartialResponseError(new Error('Response has been interrupted before response could be parsed.'), true));\n        }\n        // else: end has been called\n    }\n    streamResponseHandler(resolve, reject, res) {\n        const code = res.statusCode;\n        if (code < 400) {\n            if (settings_1.TwitterApiV2Settings.debug) {\n                settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${res.statusCode} (starting stream)`);\n            }\n            const dataStream = this.getResponseDataStream(res);\n            // HTTP code ok, consume stream\n            resolve({ req: this.req, res: dataStream, originalResponse: res, requestData: this.requestData });\n        }\n        else {\n            // Handle response normally, can only rejects\n            this.classicResponseHandler(() => undefined, reject, res);\n        }\n    }\n    /* Wrappers for request lifecycle */\n    debugRequest() {\n        const url = this.requestData.url;\n        settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]`, this.requestData.options);\n        if (url.search) {\n            settings_1.TwitterApiV2Settings.logger.log('Request parameters:', [...url.searchParams.entries()].map(([key, value]) => `${key}: ${value}`));\n        }\n        if (this.requestData.body) {\n            settings_1.TwitterApiV2Settings.logger.log('Request body:', this.requestData.body);\n        }\n    }\n    buildRequest() {\n        var _a;\n        const url = this.requestData.url;\n        const auth = url.username ? `${url.username}:${url.password}` : undefined;\n        const headers = (_a = this.requestData.options.headers) !== null && _a !== void 0 ? _a : {};\n        if (this.requestData.compression === true || this.requestData.compression === 'brotli') {\n            headers['accept-encoding'] = 'br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1';\n        }\n        else if (this.requestData.compression === 'gzip') {\n            headers['accept-encoding'] = 'gzip;q=1, deflate;q=0.5, *;q=0.1';\n        }\n        else if (this.requestData.compression === 'deflate') {\n            headers['accept-encoding'] = 'deflate;q=1, *;q=0.1';\n        }\n        if (settings_1.TwitterApiV2Settings.debug) {\n            this.debugRequest();\n        }\n        this.req = (0, https_1.request)({\n            ...this.requestData.options,\n            // Define URL params manually, addresses dependencies error https://github.com/PLhery/node-twitter-api-v2/issues/94\n            host: url.hostname,\n            port: url.port || undefined,\n            path: url.pathname + url.search,\n            protocol: url.protocol,\n            auth,\n            headers,\n        });\n    }\n    registerRequestEventDebugHandlers(req) {\n        req.on('close', () => this.requestData.requestEventDebugHandler('close'));\n        req.on('abort', () => this.requestData.requestEventDebugHandler('abort'));\n        req.on('socket', socket => {\n            this.requestData.requestEventDebugHandler('socket', { socket });\n            socket.on('error', error => this.requestData.requestEventDebugHandler('socket-error', { socket, error }));\n            socket.on('connect', () => this.requestData.requestEventDebugHandler('socket-connect', { socket }));\n            socket.on('close', withError => this.requestData.requestEventDebugHandler('socket-close', { socket, withError }));\n            socket.on('end', () => this.requestData.requestEventDebugHandler('socket-end', { socket }));\n            socket.on('lookup', (...data) => this.requestData.requestEventDebugHandler('socket-lookup', { socket, data }));\n            socket.on('timeout', () => this.requestData.requestEventDebugHandler('socket-timeout', { socket }));\n        });\n    }\n    makeRequest() {\n        this.buildRequest();\n        return new Promise((resolve, reject) => {\n            const req = this.req;\n            // Handle request errors\n            req.on('error', this.requestErrorHandler.bind(this, reject));\n            req.on('socket', this.onSocketEventHandler.bind(this, reject));\n            req.on('response', this.classicResponseHandler.bind(this, resolve, reject));\n            if (this.requestData.options.timeout) {\n                req.on('timeout', this.timeoutErrorHandler.bind(this));\n            }\n            // Debug handlers\n            if (this.requestData.requestEventDebugHandler) {\n                this.registerRequestEventDebugHandlers(req);\n            }\n            if (this.requestData.body) {\n                req.write(this.requestData.body);\n            }\n            req.end();\n        });\n    }\n    async makeRequestAsStream() {\n        const { req, res, requestData, originalResponse } = await this.makeRequestAndResolveWhenReady();\n        return new TweetStream_1.default(requestData, { req, res, originalResponse });\n    }\n    makeRequestAndResolveWhenReady() {\n        this.buildRequest();\n        return new Promise((resolve, reject) => {\n            const req = this.req;\n            // Handle request errors\n            req.on('error', this.requestErrorHandler.bind(this, reject));\n            req.on('response', this.streamResponseHandler.bind(this, resolve, reject));\n            if (this.requestData.body) {\n                req.write(this.requestData.body);\n            }\n            req.end();\n        });\n    }\n}\nexports.RequestHandlerHelper = RequestHandlerHelper;\nexports.default = RequestHandlerHelper;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}