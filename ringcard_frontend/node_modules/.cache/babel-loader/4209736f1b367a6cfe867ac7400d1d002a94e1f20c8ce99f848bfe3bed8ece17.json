{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RequestHandlerHelper = void 0;\nconst https_1 = require(\"https\");\nconst settings_1 = require(\"../settings\");\nconst TweetStream_1 = __importDefault(require(\"../stream/TweetStream\"));\nconst types_1 = require(\"../types\");\nconst zlib = __importStar(require(\"zlib\"));\nclass RequestHandlerHelper {\n  constructor(requestData) {\n    this.requestData = requestData;\n    this.requestErrorHandled = false;\n    this.responseData = [];\n  }\n  /* Request helpers */\n  get hrefPathname() {\n    const url = this.requestData.url;\n    return url.hostname + url.pathname;\n  }\n  isCompressionDisabled() {\n    return !this.requestData.compression || this.requestData.compression === 'identity';\n  }\n  isFormEncodedEndpoint() {\n    return this.requestData.url.href.startsWith('https://api.twitter.com/oauth/');\n  }\n  /* Error helpers */\n  createRequestError(error) {\n    if (settings_1.TwitterApiV2Settings.debug) {\n      settings_1.TwitterApiV2Settings.logger.log('Request error:', error);\n    }\n    return new types_1.ApiRequestError('Request failed.', {\n      request: this.req,\n      error\n    });\n  }\n  createPartialResponseError(error, abortClose) {\n    const res = this.res;\n    let message = `Request failed with partial response with HTTP code ${res.statusCode}`;\n    if (abortClose) {\n      message += ' (connection abruptly closed)';\n    } else {\n      message += ' (parse error)';\n    }\n    return new types_1.ApiPartialResponseError(message, {\n      request: this.req,\n      response: this.res,\n      responseError: error,\n      rawContent: Buffer.concat(this.responseData).toString()\n    });\n  }\n  formatV1Errors(errors) {\n    return errors.map(_ref => {\n      let {\n        code,\n        message\n      } = _ref;\n      return `${message} (Twitter code ${code})`;\n    }).join(', ');\n  }\n  formatV2Error(error) {\n    return `${error.title}: ${error.detail} (see ${error.type})`;\n  }\n  createResponseError(_ref2) {\n    let {\n      res,\n      data,\n      rateLimit,\n      code\n    } = _ref2;\n    var _a;\n    if (settings_1.TwitterApiV2Settings.debug) {\n      settings_1.TwitterApiV2Settings.logger.log(`Request failed with code ${code}, data:`, data);\n      settings_1.TwitterApiV2Settings.logger.log('Response headers:', res.headers);\n    }\n    // Errors formatting.\n    let errorString = `Request failed with code ${code}`;\n    if ((_a = data === null || data === void 0 ? void 0 : data.errors) === null || _a === void 0 ? void 0 : _a.length) {\n      const errors = data.errors;\n      if ('code' in errors[0]) {\n        errorString += ' - ' + this.formatV1Errors(errors);\n      } else {\n        errorString += ' - ' + this.formatV2Error(data);\n      }\n    }\n    return new types_1.ApiResponseError(errorString, {\n      code,\n      data,\n      headers: res.headers,\n      request: this.req,\n      response: res,\n      rateLimit\n    });\n  }\n  /* Response helpers */\n  getResponseDataStream(res) {\n    if (this.isCompressionDisabled()) {\n      return res;\n    }\n    const contentEncoding = (res.headers['content-encoding'] || 'identity').trim().toLowerCase();\n    if (contentEncoding === 'br') {\n      const brotli = zlib.createBrotliDecompress({\n        flush: zlib.constants.BROTLI_OPERATION_FLUSH,\n        finishFlush: zlib.constants.BROTLI_OPERATION_FLUSH\n      });\n      res.pipe(brotli);\n      return brotli;\n    }\n    if (contentEncoding === 'gzip') {\n      const gunzip = zlib.createGunzip({\n        flush: zlib.constants.Z_SYNC_FLUSH,\n        finishFlush: zlib.constants.Z_SYNC_FLUSH\n      });\n      res.pipe(gunzip);\n      return gunzip;\n    }\n    if (contentEncoding === 'deflate') {\n      const inflate = zlib.createInflate({\n        flush: zlib.constants.Z_SYNC_FLUSH,\n        finishFlush: zlib.constants.Z_SYNC_FLUSH\n      });\n      res.pipe(inflate);\n      return inflate;\n    }\n    return res;\n  }\n  detectResponseType(res) {\n    var _a, _b;\n    // Auto parse if server responds with JSON body\n    if (((_a = res.headers['content-type']) === null || _a === void 0 ? void 0 : _a.includes('application/json')) || ((_b = res.headers['content-type']) === null || _b === void 0 ? void 0 : _b.includes('application/problem+json'))) {\n      return 'json';\n    }\n    // f-e oauth token endpoints\n    else if (this.isFormEncodedEndpoint()) {\n      return 'url';\n    }\n    return 'text';\n  }\n  getParsedResponse(res) {\n    const data = this.responseData;\n    const mode = this.requestData.forceParseMode || this.detectResponseType(res);\n    if (mode === 'buffer') {\n      return Buffer.concat(data);\n    } else if (mode === 'text') {\n      return Buffer.concat(data).toString();\n    } else if (mode === 'json') {\n      const asText = Buffer.concat(data).toString();\n      return asText.length ? JSON.parse(asText) : undefined;\n    } else if (mode === 'url') {\n      const asText = Buffer.concat(data).toString();\n      const formEntries = {};\n      for (const [item, value] of new URLSearchParams(asText)) {\n        formEntries[item] = value;\n      }\n      return formEntries;\n    } else {\n      // mode === 'none'\n      return undefined;\n    }\n  }\n  getRateLimitFromResponse(res) {\n    let rateLimit = undefined;\n    if (res.headers['x-rate-limit-limit']) {\n      rateLimit = {\n        limit: Number(res.headers['x-rate-limit-limit']),\n        remaining: Number(res.headers['x-rate-limit-remaining']),\n        reset: Number(res.headers['x-rate-limit-reset'])\n      };\n      if (this.requestData.rateLimitSaver) {\n        this.requestData.rateLimitSaver(rateLimit);\n      }\n    }\n    return rateLimit;\n  }\n  /* Request event handlers */\n  onSocketEventHandler(reject, socket) {\n    socket.on('close', this.onSocketCloseHandler.bind(this, reject));\n  }\n  onSocketCloseHandler(reject) {\n    this.req.removeAllListeners('timeout');\n    const res = this.res;\n    if (res) {\n      // Response ok, res.close/res.end can handle request ending\n      return;\n    }\n    if (!this.requestErrorHandled) {\n      return reject(this.createRequestError(new Error('Socket closed without any information.')));\n    }\n    // else: other situation\n  }\n\n  requestErrorHandler(reject, requestError) {\n    var _a, _b;\n    (_b = (_a = this.requestData).requestEventDebugHandler) === null || _b === void 0 ? void 0 : _b.call(_a, 'request-error', {\n      requestError\n    });\n    this.requestErrorHandled = true;\n    reject(this.createRequestError(requestError));\n  }\n  timeoutErrorHandler() {\n    this.requestErrorHandled = true;\n    this.req.destroy(new Error('Request timeout.'));\n  }\n  /* Response event handlers */\n  classicResponseHandler(resolve, reject, res) {\n    this.res = res;\n    const dataStream = this.getResponseDataStream(res);\n    // Register the response data\n    dataStream.on('data', chunk => this.responseData.push(chunk));\n    dataStream.on('end', this.onResponseEndHandler.bind(this, resolve, reject));\n    dataStream.on('close', this.onResponseCloseHandler.bind(this, resolve, reject));\n    // Debug handlers\n    if (this.requestData.requestEventDebugHandler) {\n      this.requestData.requestEventDebugHandler('response', {\n        res\n      });\n      res.on('aborted', error => this.requestData.requestEventDebugHandler('response-aborted', {\n        error\n      }));\n      res.on('error', error => this.requestData.requestEventDebugHandler('response-error', {\n        error\n      }));\n      res.on('close', () => this.requestData.requestEventDebugHandler('response-close', {\n        data: this.responseData\n      }));\n      res.on('end', () => this.requestData.requestEventDebugHandler('response-end'));\n    }\n  }\n  onResponseEndHandler(resolve, reject) {\n    const rateLimit = this.getRateLimitFromResponse(this.res);\n    let data;\n    try {\n      data = this.getParsedResponse(this.res);\n    } catch (e) {\n      reject(this.createPartialResponseError(e, false));\n      return;\n    }\n    // Handle bad error codes\n    const code = this.res.statusCode;\n    if (code >= 400) {\n      reject(this.createResponseError({\n        data,\n        res: this.res,\n        rateLimit,\n        code\n      }));\n      return;\n    }\n    if (settings_1.TwitterApiV2Settings.debug) {\n      settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${this.res.statusCode}`);\n      settings_1.TwitterApiV2Settings.logger.log('Response body:', data);\n    }\n    resolve({\n      data,\n      headers: this.res.headers,\n      rateLimit\n    });\n  }\n  onResponseCloseHandler(resolve, reject) {\n    const res = this.res;\n    if (res.aborted) {\n      // Try to parse the request (?)\n      try {\n        this.getParsedResponse(this.res);\n        // Ok, try to resolve normally the request\n        return this.onResponseEndHandler(resolve, reject);\n      } catch (e) {\n        // Parse error, just drop with content\n        return reject(this.createPartialResponseError(e, true));\n      }\n    }\n    if (!res.complete) {\n      return reject(this.createPartialResponseError(new Error('Response has been interrupted before response could be parsed.'), true));\n    }\n    // else: end has been called\n  }\n\n  streamResponseHandler(resolve, reject, res) {\n    const code = res.statusCode;\n    if (code < 400) {\n      if (settings_1.TwitterApiV2Settings.debug) {\n        settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${res.statusCode} (starting stream)`);\n      }\n      const dataStream = this.getResponseDataStream(res);\n      // HTTP code ok, consume stream\n      resolve({\n        req: this.req,\n        res: dataStream,\n        originalResponse: res,\n        requestData: this.requestData\n      });\n    } else {\n      // Handle response normally, can only rejects\n      this.classicResponseHandler(() => undefined, reject, res);\n    }\n  }\n  /* Wrappers for request lifecycle */\n  debugRequest() {\n    const url = this.requestData.url;\n    settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]`, this.requestData.options);\n    if (url.search) {\n      settings_1.TwitterApiV2Settings.logger.log('Request parameters:', [...url.searchParams.entries()].map(_ref3 => {\n        let [key, value] = _ref3;\n        return `${key}: ${value}`;\n      }));\n    }\n    if (this.requestData.body) {\n      settings_1.TwitterApiV2Settings.logger.log('Request body:', this.requestData.body);\n    }\n  }\n  buildRequest() {\n    var _a;\n    const url = this.requestData.url;\n    const auth = url.username ? `${url.username}:${url.password}` : undefined;\n    const headers = (_a = this.requestData.options.headers) !== null && _a !== void 0 ? _a : {};\n    if (this.requestData.compression === true || this.requestData.compression === 'brotli') {\n      headers['accept-encoding'] = 'br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1';\n    } else if (this.requestData.compression === 'gzip') {\n      headers['accept-encoding'] = 'gzip;q=1, deflate;q=0.5, *;q=0.1';\n    } else if (this.requestData.compression === 'deflate') {\n      headers['accept-encoding'] = 'deflate;q=1, *;q=0.1';\n    }\n    if (settings_1.TwitterApiV2Settings.debug) {\n      this.debugRequest();\n    }\n    this.req = (0, https_1.request)({\n      ...this.requestData.options,\n      // Define URL params manually, addresses dependencies error https://github.com/PLhery/node-twitter-api-v2/issues/94\n      host: url.hostname,\n      port: url.port || undefined,\n      path: url.pathname + url.search,\n      protocol: url.protocol,\n      auth,\n      headers\n    });\n  }\n  registerRequestEventDebugHandlers(req) {\n    var _this = this;\n    req.on('close', () => this.requestData.requestEventDebugHandler('close'));\n    req.on('abort', () => this.requestData.requestEventDebugHandler('abort'));\n    req.on('socket', socket => {\n      this.requestData.requestEventDebugHandler('socket', {\n        socket\n      });\n      socket.on('error', error => this.requestData.requestEventDebugHandler('socket-error', {\n        socket,\n        error\n      }));\n      socket.on('connect', () => this.requestData.requestEventDebugHandler('socket-connect', {\n        socket\n      }));\n      socket.on('close', withError => this.requestData.requestEventDebugHandler('socket-close', {\n        socket,\n        withError\n      }));\n      socket.on('end', () => this.requestData.requestEventDebugHandler('socket-end', {\n        socket\n      }));\n      socket.on('lookup', function () {\n        for (var _len = arguments.length, data = new Array(_len), _key = 0; _key < _len; _key++) {\n          data[_key] = arguments[_key];\n        }\n        return _this.requestData.requestEventDebugHandler('socket-lookup', {\n          socket,\n          data\n        });\n      });\n      socket.on('timeout', () => this.requestData.requestEventDebugHandler('socket-timeout', {\n        socket\n      }));\n    });\n  }\n  makeRequest() {\n    this.buildRequest();\n    return new Promise((resolve, reject) => {\n      const req = this.req;\n      // Handle request errors\n      req.on('error', this.requestErrorHandler.bind(this, reject));\n      req.on('socket', this.onSocketEventHandler.bind(this, reject));\n      req.on('response', this.classicResponseHandler.bind(this, resolve, reject));\n      if (this.requestData.options.timeout) {\n        req.on('timeout', this.timeoutErrorHandler.bind(this));\n      }\n      // Debug handlers\n      if (this.requestData.requestEventDebugHandler) {\n        this.registerRequestEventDebugHandlers(req);\n      }\n      if (this.requestData.body) {\n        req.write(this.requestData.body);\n      }\n      req.end();\n    });\n  }\n  async makeRequestAsStream() {\n    const {\n      req,\n      res,\n      requestData,\n      originalResponse\n    } = await this.makeRequestAndResolveWhenReady();\n    return new TweetStream_1.default(requestData, {\n      req,\n      res,\n      originalResponse\n    });\n  }\n  makeRequestAndResolveWhenReady() {\n    this.buildRequest();\n    return new Promise((resolve, reject) => {\n      const req = this.req;\n      // Handle request errors\n      req.on('error', this.requestErrorHandler.bind(this, reject));\n      req.on('response', this.streamResponseHandler.bind(this, resolve, reject));\n      if (this.requestData.body) {\n        req.write(this.requestData.body);\n      }\n      req.end();\n    });\n  }\n}\nexports.RequestHandlerHelper = RequestHandlerHelper;\nexports.default = RequestHandlerHelper;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","RequestHandlerHelper","https_1","require","settings_1","TweetStream_1","types_1","zlib","constructor","requestData","requestErrorHandled","responseData","hrefPathname","url","hostname","pathname","isCompressionDisabled","compression","isFormEncodedEndpoint","href","startsWith","createRequestError","error","TwitterApiV2Settings","debug","logger","log","ApiRequestError","request","req","createPartialResponseError","abortClose","res","message","statusCode","ApiPartialResponseError","response","responseError","rawContent","Buffer","concat","toString","formatV1Errors","errors","map","code","join","formatV2Error","title","detail","type","createResponseError","data","rateLimit","_a","headers","errorString","length","ApiResponseError","getResponseDataStream","contentEncoding","trim","toLowerCase","brotli","createBrotliDecompress","flush","constants","BROTLI_OPERATION_FLUSH","finishFlush","pipe","gunzip","createGunzip","Z_SYNC_FLUSH","inflate","createInflate","detectResponseType","_b","includes","getParsedResponse","mode","forceParseMode","asText","JSON","parse","formEntries","item","URLSearchParams","getRateLimitFromResponse","limit","Number","remaining","reset","rateLimitSaver","onSocketEventHandler","reject","socket","on","onSocketCloseHandler","bind","removeAllListeners","Error","requestErrorHandler","requestError","requestEventDebugHandler","timeoutErrorHandler","destroy","classicResponseHandler","resolve","dataStream","chunk","push","onResponseEndHandler","onResponseCloseHandler","e","options","method","aborted","complete","streamResponseHandler","originalResponse","debugRequest","search","searchParams","entries","key","body","buildRequest","auth","username","password","host","port","path","protocol","registerRequestEventDebugHandlers","withError","makeRequest","Promise","timeout","write","end","makeRequestAsStream","makeRequestAndResolveWhenReady","default"],"sources":["C:/Users/yuleg/Dev/Ringca/ORIN33/ringcard/ringcard_frontend/node_modules/twitter-api-v2/dist/client-mixins/request-handler.helper.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RequestHandlerHelper = void 0;\nconst https_1 = require(\"https\");\nconst settings_1 = require(\"../settings\");\nconst TweetStream_1 = __importDefault(require(\"../stream/TweetStream\"));\nconst types_1 = require(\"../types\");\nconst zlib = __importStar(require(\"zlib\"));\nclass RequestHandlerHelper {\n    constructor(requestData) {\n        this.requestData = requestData;\n        this.requestErrorHandled = false;\n        this.responseData = [];\n    }\n    /* Request helpers */\n    get hrefPathname() {\n        const url = this.requestData.url;\n        return url.hostname + url.pathname;\n    }\n    isCompressionDisabled() {\n        return !this.requestData.compression || this.requestData.compression === 'identity';\n    }\n    isFormEncodedEndpoint() {\n        return this.requestData.url.href.startsWith('https://api.twitter.com/oauth/');\n    }\n    /* Error helpers */\n    createRequestError(error) {\n        if (settings_1.TwitterApiV2Settings.debug) {\n            settings_1.TwitterApiV2Settings.logger.log('Request error:', error);\n        }\n        return new types_1.ApiRequestError('Request failed.', {\n            request: this.req,\n            error,\n        });\n    }\n    createPartialResponseError(error, abortClose) {\n        const res = this.res;\n        let message = `Request failed with partial response with HTTP code ${res.statusCode}`;\n        if (abortClose) {\n            message += ' (connection abruptly closed)';\n        }\n        else {\n            message += ' (parse error)';\n        }\n        return new types_1.ApiPartialResponseError(message, {\n            request: this.req,\n            response: this.res,\n            responseError: error,\n            rawContent: Buffer.concat(this.responseData).toString(),\n        });\n    }\n    formatV1Errors(errors) {\n        return errors\n            .map(({ code, message }) => `${message} (Twitter code ${code})`)\n            .join(', ');\n    }\n    formatV2Error(error) {\n        return `${error.title}: ${error.detail} (see ${error.type})`;\n    }\n    createResponseError({ res, data, rateLimit, code }) {\n        var _a;\n        if (settings_1.TwitterApiV2Settings.debug) {\n            settings_1.TwitterApiV2Settings.logger.log(`Request failed with code ${code}, data:`, data);\n            settings_1.TwitterApiV2Settings.logger.log('Response headers:', res.headers);\n        }\n        // Errors formatting.\n        let errorString = `Request failed with code ${code}`;\n        if ((_a = data === null || data === void 0 ? void 0 : data.errors) === null || _a === void 0 ? void 0 : _a.length) {\n            const errors = data.errors;\n            if ('code' in errors[0]) {\n                errorString += ' - ' + this.formatV1Errors(errors);\n            }\n            else {\n                errorString += ' - ' + this.formatV2Error(data);\n            }\n        }\n        return new types_1.ApiResponseError(errorString, {\n            code,\n            data,\n            headers: res.headers,\n            request: this.req,\n            response: res,\n            rateLimit,\n        });\n    }\n    /* Response helpers */\n    getResponseDataStream(res) {\n        if (this.isCompressionDisabled()) {\n            return res;\n        }\n        const contentEncoding = (res.headers['content-encoding'] || 'identity').trim().toLowerCase();\n        if (contentEncoding === 'br') {\n            const brotli = zlib.createBrotliDecompress({\n                flush: zlib.constants.BROTLI_OPERATION_FLUSH,\n                finishFlush: zlib.constants.BROTLI_OPERATION_FLUSH,\n            });\n            res.pipe(brotli);\n            return brotli;\n        }\n        if (contentEncoding === 'gzip') {\n            const gunzip = zlib.createGunzip({\n                flush: zlib.constants.Z_SYNC_FLUSH,\n                finishFlush: zlib.constants.Z_SYNC_FLUSH,\n            });\n            res.pipe(gunzip);\n            return gunzip;\n        }\n        if (contentEncoding === 'deflate') {\n            const inflate = zlib.createInflate({\n                flush: zlib.constants.Z_SYNC_FLUSH,\n                finishFlush: zlib.constants.Z_SYNC_FLUSH,\n            });\n            res.pipe(inflate);\n            return inflate;\n        }\n        return res;\n    }\n    detectResponseType(res) {\n        var _a, _b;\n        // Auto parse if server responds with JSON body\n        if (((_a = res.headers['content-type']) === null || _a === void 0 ? void 0 : _a.includes('application/json')) || ((_b = res.headers['content-type']) === null || _b === void 0 ? void 0 : _b.includes('application/problem+json'))) {\n            return 'json';\n        }\n        // f-e oauth token endpoints\n        else if (this.isFormEncodedEndpoint()) {\n            return 'url';\n        }\n        return 'text';\n    }\n    getParsedResponse(res) {\n        const data = this.responseData;\n        const mode = this.requestData.forceParseMode || this.detectResponseType(res);\n        if (mode === 'buffer') {\n            return Buffer.concat(data);\n        }\n        else if (mode === 'text') {\n            return Buffer.concat(data).toString();\n        }\n        else if (mode === 'json') {\n            const asText = Buffer.concat(data).toString();\n            return asText.length ? JSON.parse(asText) : undefined;\n        }\n        else if (mode === 'url') {\n            const asText = Buffer.concat(data).toString();\n            const formEntries = {};\n            for (const [item, value] of new URLSearchParams(asText)) {\n                formEntries[item] = value;\n            }\n            return formEntries;\n        }\n        else {\n            // mode === 'none'\n            return undefined;\n        }\n    }\n    getRateLimitFromResponse(res) {\n        let rateLimit = undefined;\n        if (res.headers['x-rate-limit-limit']) {\n            rateLimit = {\n                limit: Number(res.headers['x-rate-limit-limit']),\n                remaining: Number(res.headers['x-rate-limit-remaining']),\n                reset: Number(res.headers['x-rate-limit-reset']),\n            };\n            if (this.requestData.rateLimitSaver) {\n                this.requestData.rateLimitSaver(rateLimit);\n            }\n        }\n        return rateLimit;\n    }\n    /* Request event handlers */\n    onSocketEventHandler(reject, socket) {\n        socket.on('close', this.onSocketCloseHandler.bind(this, reject));\n    }\n    onSocketCloseHandler(reject) {\n        this.req.removeAllListeners('timeout');\n        const res = this.res;\n        if (res) {\n            // Response ok, res.close/res.end can handle request ending\n            return;\n        }\n        if (!this.requestErrorHandled) {\n            return reject(this.createRequestError(new Error('Socket closed without any information.')));\n        }\n        // else: other situation\n    }\n    requestErrorHandler(reject, requestError) {\n        var _a, _b;\n        (_b = (_a = this.requestData).requestEventDebugHandler) === null || _b === void 0 ? void 0 : _b.call(_a, 'request-error', { requestError });\n        this.requestErrorHandled = true;\n        reject(this.createRequestError(requestError));\n    }\n    timeoutErrorHandler() {\n        this.requestErrorHandled = true;\n        this.req.destroy(new Error('Request timeout.'));\n    }\n    /* Response event handlers */\n    classicResponseHandler(resolve, reject, res) {\n        this.res = res;\n        const dataStream = this.getResponseDataStream(res);\n        // Register the response data\n        dataStream.on('data', chunk => this.responseData.push(chunk));\n        dataStream.on('end', this.onResponseEndHandler.bind(this, resolve, reject));\n        dataStream.on('close', this.onResponseCloseHandler.bind(this, resolve, reject));\n        // Debug handlers\n        if (this.requestData.requestEventDebugHandler) {\n            this.requestData.requestEventDebugHandler('response', { res });\n            res.on('aborted', error => this.requestData.requestEventDebugHandler('response-aborted', { error }));\n            res.on('error', error => this.requestData.requestEventDebugHandler('response-error', { error }));\n            res.on('close', () => this.requestData.requestEventDebugHandler('response-close', { data: this.responseData }));\n            res.on('end', () => this.requestData.requestEventDebugHandler('response-end'));\n        }\n    }\n    onResponseEndHandler(resolve, reject) {\n        const rateLimit = this.getRateLimitFromResponse(this.res);\n        let data;\n        try {\n            data = this.getParsedResponse(this.res);\n        }\n        catch (e) {\n            reject(this.createPartialResponseError(e, false));\n            return;\n        }\n        // Handle bad error codes\n        const code = this.res.statusCode;\n        if (code >= 400) {\n            reject(this.createResponseError({ data, res: this.res, rateLimit, code }));\n            return;\n        }\n        if (settings_1.TwitterApiV2Settings.debug) {\n            settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${this.res.statusCode}`);\n            settings_1.TwitterApiV2Settings.logger.log('Response body:', data);\n        }\n        resolve({\n            data,\n            headers: this.res.headers,\n            rateLimit,\n        });\n    }\n    onResponseCloseHandler(resolve, reject) {\n        const res = this.res;\n        if (res.aborted) {\n            // Try to parse the request (?)\n            try {\n                this.getParsedResponse(this.res);\n                // Ok, try to resolve normally the request\n                return this.onResponseEndHandler(resolve, reject);\n            }\n            catch (e) {\n                // Parse error, just drop with content\n                return reject(this.createPartialResponseError(e, true));\n            }\n        }\n        if (!res.complete) {\n            return reject(this.createPartialResponseError(new Error('Response has been interrupted before response could be parsed.'), true));\n        }\n        // else: end has been called\n    }\n    streamResponseHandler(resolve, reject, res) {\n        const code = res.statusCode;\n        if (code < 400) {\n            if (settings_1.TwitterApiV2Settings.debug) {\n                settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${res.statusCode} (starting stream)`);\n            }\n            const dataStream = this.getResponseDataStream(res);\n            // HTTP code ok, consume stream\n            resolve({ req: this.req, res: dataStream, originalResponse: res, requestData: this.requestData });\n        }\n        else {\n            // Handle response normally, can only rejects\n            this.classicResponseHandler(() => undefined, reject, res);\n        }\n    }\n    /* Wrappers for request lifecycle */\n    debugRequest() {\n        const url = this.requestData.url;\n        settings_1.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]`, this.requestData.options);\n        if (url.search) {\n            settings_1.TwitterApiV2Settings.logger.log('Request parameters:', [...url.searchParams.entries()].map(([key, value]) => `${key}: ${value}`));\n        }\n        if (this.requestData.body) {\n            settings_1.TwitterApiV2Settings.logger.log('Request body:', this.requestData.body);\n        }\n    }\n    buildRequest() {\n        var _a;\n        const url = this.requestData.url;\n        const auth = url.username ? `${url.username}:${url.password}` : undefined;\n        const headers = (_a = this.requestData.options.headers) !== null && _a !== void 0 ? _a : {};\n        if (this.requestData.compression === true || this.requestData.compression === 'brotli') {\n            headers['accept-encoding'] = 'br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1';\n        }\n        else if (this.requestData.compression === 'gzip') {\n            headers['accept-encoding'] = 'gzip;q=1, deflate;q=0.5, *;q=0.1';\n        }\n        else if (this.requestData.compression === 'deflate') {\n            headers['accept-encoding'] = 'deflate;q=1, *;q=0.1';\n        }\n        if (settings_1.TwitterApiV2Settings.debug) {\n            this.debugRequest();\n        }\n        this.req = (0, https_1.request)({\n            ...this.requestData.options,\n            // Define URL params manually, addresses dependencies error https://github.com/PLhery/node-twitter-api-v2/issues/94\n            host: url.hostname,\n            port: url.port || undefined,\n            path: url.pathname + url.search,\n            protocol: url.protocol,\n            auth,\n            headers,\n        });\n    }\n    registerRequestEventDebugHandlers(req) {\n        req.on('close', () => this.requestData.requestEventDebugHandler('close'));\n        req.on('abort', () => this.requestData.requestEventDebugHandler('abort'));\n        req.on('socket', socket => {\n            this.requestData.requestEventDebugHandler('socket', { socket });\n            socket.on('error', error => this.requestData.requestEventDebugHandler('socket-error', { socket, error }));\n            socket.on('connect', () => this.requestData.requestEventDebugHandler('socket-connect', { socket }));\n            socket.on('close', withError => this.requestData.requestEventDebugHandler('socket-close', { socket, withError }));\n            socket.on('end', () => this.requestData.requestEventDebugHandler('socket-end', { socket }));\n            socket.on('lookup', (...data) => this.requestData.requestEventDebugHandler('socket-lookup', { socket, data }));\n            socket.on('timeout', () => this.requestData.requestEventDebugHandler('socket-timeout', { socket }));\n        });\n    }\n    makeRequest() {\n        this.buildRequest();\n        return new Promise((resolve, reject) => {\n            const req = this.req;\n            // Handle request errors\n            req.on('error', this.requestErrorHandler.bind(this, reject));\n            req.on('socket', this.onSocketEventHandler.bind(this, reject));\n            req.on('response', this.classicResponseHandler.bind(this, resolve, reject));\n            if (this.requestData.options.timeout) {\n                req.on('timeout', this.timeoutErrorHandler.bind(this));\n            }\n            // Debug handlers\n            if (this.requestData.requestEventDebugHandler) {\n                this.registerRequestEventDebugHandlers(req);\n            }\n            if (this.requestData.body) {\n                req.write(this.requestData.body);\n            }\n            req.end();\n        });\n    }\n    async makeRequestAsStream() {\n        const { req, res, requestData, originalResponse } = await this.makeRequestAndResolveWhenReady();\n        return new TweetStream_1.default(requestData, { req, res, originalResponse });\n    }\n    makeRequestAndResolveWhenReady() {\n        this.buildRequest();\n        return new Promise((resolve, reject) => {\n            const req = this.req;\n            // Handle request errors\n            req.on('error', this.requestErrorHandler.bind(this, reject));\n            req.on('response', this.streamResponseHandler.bind(this, resolve, reject));\n            if (this.requestData.body) {\n                req.write(this.requestData.body);\n            }\n            req.end();\n        });\n    }\n}\nexports.RequestHandlerHelper = RequestHandlerHelper;\nexports.default = RequestHandlerHelper;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}